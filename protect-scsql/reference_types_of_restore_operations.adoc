---
permalink: protect-scsql/reference_types_of_restore_operations.html 
sidebar: sidebar 
keywords: SnapCenter Plug-in for SQL Server 
summary: 您可以使用SnapCenter对 SQL Server 资源执行不同类型的还原操作。 
---
= 恢复操作的类型
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
您可以使用SnapCenter对 SQL Server 资源执行不同类型的还原操作。

* 恢复最新状态
* 恢复到之前的时间点


在以下情况下，您可以恢复到最新时间点或恢复到之前的时间点：

* 从SnapMirror或SnapVault二级存储恢复
* 恢复到备用路径（位置）



NOTE: SnapCenter不支持基于卷的SnapRestore。



== 恢复最新状态

在最新的恢复操作（默认选择）中，数据库将恢复到故障点。  SnapCenter通过执行以下序列来实现此目的：

. 在恢复数据库之前备份最后一个活动事务日志。
. 从您选择的完整数据库备份中还原数据库。
. 应用所有未提交到数据库的事务日志（包括从备份创建时到当前时间的备份事务日志）。
+
事务日志被向前移动并应用于任何选定的数据库。



最新的恢复操作需要一组连续的事务日志。

由于SnapCenter无法从日志传送备份文件还原 SQL Server 数据库事务日志（日志传送使您能够自动将事务日志备份从主服务器实例上的主数据库发送到单独的辅助服务器实例上的一个或多个辅助数据库），因此您无法从事务日志备份执行最新的还原操作。因此，您应该使用SnapCenter来备份 SQL Server 数据库事务日志文件。

如果您不需要为所有备份保留最新的还原功能，则可以通过备份策略配置系统的事务日志备份保留。



== 最新恢复操作的示例

假设您每天中午运行 SQL Server 备份，并且星期三下午 4:00 需要从备份中恢复。由于某种原因，周三中午的备份未能验证，因此您决定从周二中午的备份中恢复。此后，如果恢复了备份，则所有事务日志都会向前移动并应用于恢复的数据库，从创建星期二备份时未提交的事务日志开始，一直到星期三下午 4:00 写入的最新事务日志（如果事务日志已备份）。



== 恢复到之前的时间点

在时间点还原操作中，数据库仅还原到过去的特定时间。时间点还原操作发生在以下还原情况下：

* 数据库恢复到备份事务日志中的给定时间。
* 数据库已恢复，并且仅将备份事务日志的子集应用于该数据库。



NOTE: 将数据库恢复到某个时间点会产生一条新的恢复路径。

下图说明了执行时间点还原操作时出现的问题：

image::../media/point_in_time_recovery_path.gif[恢复到之前的时间点]

在图像中，恢复路径 1 由完整备份和随后的几个事务日志备份组成。您将数据库还原到某个时间点。时间点还原操作后会创建新的事务日志备份，从而产生恢复路径 2。新的事务日志备份是在没有创建新的完整备份的情况下创建的。由于数据损坏或其他问题，您无法恢复当前数据库，直到创建新的完整备份。此外，无法将在恢复路径 2 中创建的事务日志应用于属于恢复路径 1 的完整备份。

如果您应用事务日志备份，您还可以指定停止应用备份事务的特定日期和时间。为此，您需要指定可用范围内的日期和时间， SnapCenter将删除该时间点之前未提交的任何事务。您可以使用此方法将数据库还原到发生损坏之前的时间点，或者从意外的数据库或表删除中恢复。



== 时间点还原操作示例

假设您在午夜进行一次完整数据库备份，并每小时进行一次事务日志备份。数据库在上午 9:45 崩溃，但您仍然备份了故障数据库的事务日志。您可以从以下时间点还原场景中进行选择：

* 恢复午夜所做的完整数据库备份，并接受随后所做的数据库更改的丢失。  （选项：无）
* 恢复完整的数据库备份并应用所有事务日志备份直到上午 9:45（选项：记录到）
* 恢复完整的数据库备份并应用事务日志备份，指定您希望事务从最后一组事务日志备份恢复的时间。  （选项：按具体时间）


在这种情况下，您需要计算报告某个错误的日期和时间。任何未在指定日期和时间之前提交的事务都将被删除。
