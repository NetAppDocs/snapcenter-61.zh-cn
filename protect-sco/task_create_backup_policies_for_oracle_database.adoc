---
permalink: protect-sco/task_create_backup_policies_for_oracle_database.html 
sidebar: sidebar 
keywords: backup policies, policies 
summary: 在使用SnapCenter备份 Oracle 数据库资源之前，您必须为要备份的资源或资源组创建备份策略。备份策略是一组规则，用于控制如何管理、安排和保留备份。您还可以指定复制、脚本和备份类型设置。当您想要在另一个资源或资源组上重复使用策略时，创建策略可以节省时间。 
---
= 为 Oracle 数据库创建备份策略
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
在使用SnapCenter备份 Oracle 数据库资源之前，您必须为要备份的资源或资源组创建备份策略。备份策略是一组规则，用于控制如何管理、安排和保留备份。您还可以指定复制、脚本和备份类型设置。当您想要在另一个资源或资源组上重复使用策略时，创建策略可以节省时间。

*开始之前*

* 您必须已经定义了您的备份策略。
* 您必须已完成安装SnapCenter、添加主机、发现数据库和创建存储系统连接等任务，为数据保护做好准备。
* 如果您要将快照复制到镜像或保管库二级存储， SnapCenter管理员必须已为您分配源卷和目标卷的 SVM。
* 如果您以非 root 用户身份安装了该插件，则应手动为 prescript 和 postscript 目录分配执行权限。
* 查看SnapMirror主动同步特定的先决条件和限制。欲了解详细信息，请参阅 https://docs.netapp.com/us-en/ontap/smbc/considerations-limits.html#volumes["SnapMirror主动同步的对象限制"]。


.关于此任务
如果选择了“保留备份副本特定天数”选项，则SnapLock保留期必须小于或等于上述保留天数。

+ 指定快照锁定期可防止在保留期到期之前删除快照。这可能导致保留的快照数量超过策略中指定的数量。

+ 对于ONTAP 9.12.1 及以下版本，作为恢复的一部分从SnapLock Vault 快照创建的克隆将继承SnapLock Vault 到期时间。存储管理员应在SnapLock到期后手动清理克隆。

*步骤*

. 在左侧导航窗格中，单击“*设置*”。
. 在“设置”页面中，单击“*策略*”。
. 从下拉列表中选择“*Oracle 数据库*”。
. 单击“*新建*”。
. 在名称页面中，输入策略名称和详细信息。
. 在“策略类型”页面中，执行以下步骤：
+
.. 选择您的存储类型。
.. 选择政策范围：
+
*** 如果您想*创建在线备份*，请选择*在线备份*。
+
您必须指定是否要备份所有数据文件、控制文件和存档日志文件，还是仅备份数据文件和控制文件，或者仅备份存档日志文件。

*** 如果您想*创建离线备份*，请选择*离线备份*，然后选择以下选项之一：
+
**** 如果要在数据库处于安装状态时创建离线备份，请选择*安装*。
**** 如果要通过将数据库更改为关闭状态来创建脱机关闭备份，请选择*关闭*。
+
如果您有可插拔数据库 (PDB)，并且想要在创建备份之前保存 PDB 的状态，则必须选择 *保存 PDB 的状态*。这使您能够在创建备份后将 PDB 恢复到其原始状态。





.. 如果要使用 Oracle Recovery Manager (RMAN) 进行目录备份，请选择*使用 Oracle Recovery Manager (RMAN) 进行目录备份*。
+
您可以使用 GUI 或使用SnapCenter CLI 命令 Catalog-SmBackupWithOracleRMAN 一次对一个备份执行延迟编目。

+

NOTE: 如果要对 RAC 数据库的备份进行编目，请确保没有针对该数据库运行其他作业。如果另一个作业正在运行，则编目操作将失败而不是排队。

.. 如果要在备份后修剪存档日志，请选择*备份后修剪存档日志*。
+

NOTE: 将跳过从数据库中未配置的存档日志目标中修剪存档日志的操作。

+

IMPORTANT: 如果您使用的是 Oracle 标准版，则可以在执行存档日志备份时使用 LOG_ARCHIVE_DEST 和 LOG_ARCHIVE_DUPLEX_DEST 参数。

+
*** 仅当您选择存档日志文件作为备份的一部分时，您才可以删除存档日志。
+

NOTE: 您必须确保 RAC 环境中的所有节点都可以访问所有存档日志位置，才能成功执行删除操作。

+
|===
| 目的 | 操作 


 a| 
删除所有存档日志
 a| 
选择*删除所有存档日志*。



 a| 
删除较旧的存档日志
 a| 
选择*删除早于*的存档日志，然后以天数和小时数指定要删除的存档日志的存在时间。



 a| 
从所有目的地删除存档日志
 a| 
选择*从所有目的地删除存档日志*。



 a| 
从作为备份一部分的日志目标中删除存档日志
 a| 
选择*从备份目的地删除存档日志*。

|===
+
image:../media/sco_backuppolicy_prunning.gif["修剪策略"]





. 在“快照和复制”页面中，执行以下步骤：
+
.. 通过选择*按需*、*每小时*、*每天*、*每周*或*每月*来指定计划频率。
+

NOTE: 您可以在创建资源组时指定备份操作的计划（开始日期和结束日期）。这使您能够创建共享相同策略和备份频率的资源组，但允许您为每个策略分配不同的备份计划。

+

NOTE: 如果您已安排在凌晨 2:00，则夏令时 (DST) 期间不会触发该计划。

.. 在数据快照保留设置部分中，指定备份类型和在备份类型页面中选择的计划类型的保留设置：
+
|===


| 目的 | 操作 


 a| 
保留一定数量的快照
 a| 
选择*要保留的副本*，然后指定要保留的快照数量。

如果快照数量超过指定数量，则会删除快照，并首先删除最旧的副本。


NOTE: 最大保留值为 1018。如果保留设置的值高于底层ONTAP版本支持的值，则备份将失败。


IMPORTANT: 如果您计划启用SnapVault复制，则必须将保留计数设置为 2 或更高。如果将保留计数设置为 1，则保留操作可能会失败，因为第一个快照是SnapVault关系的参考快照，直到较新的快照复制到目标。



 a| 
将快照保留一定天数
 a| 
选择*保留副本*，然后指定在删除快照之前要保留快照的天数。



 a| 
快照副本锁定期
 a| 
选择*Snapshot 副本锁定期限*并指定天、月或年的持续时间。

SnapLock保留期应少于 100 年。

|===
.. 在存档日志快照保留设置部分中，指定备份类型和备份类型页面中选择的计划类型的保留设置：
+
|===


| 目的 | 操作 


 a| 
保留一定数量的快照
 a| 
选择*要保留的副本*，然后指定要保留的快照数量。

如果快照数量超过指定数量，则会删除快照，并首先删除最旧的副本。


NOTE: 最大保留值为 1018。如果保留设置的值高于底层ONTAP版本支持的值，则备份将失败。


IMPORTANT: 如果您计划启用SnapVault复制，则必须将保留计数设置为 2 或更高。如果将保留计数设置为 1，则保留操作可能会失败，因为第一个快照是SnapVault关系的参考快照，直到较新的快照复制到目标。



 a| 
将快照保留一定天数
 a| 
选择*保留副本*，然后指定在删除快照之前要保留快照的天数。



 a| 
快照副本锁定期
 a| 
选择*Snapshot 副本锁定期限*并指定天、月或年的持续时间。

SnapLock保留期应少于 100 年。

|===
.. 选择策略标签。
+

NOTE: 您可以为远程复制的主快照分配SnapMirror标签，从而允许主快照将快照复制操作从SnapCenter卸载到ONTAP二级系统。无需在策略页面中启用SnapMirror或SnapVault选项即可完成此操作。



. 在“选择辅助复制选项”部分中，选择以下一个或两个辅助复制选项：
+

NOTE: 您必须选择辅助复制选项才能使*辅助快照副本锁定期*生效。

+
|===
| 对于这个领域... | 操作 


 a| 
创建本地快照后更新SnapMirror
 a| 
选择此字段可在另一个卷上创建备份集的镜像副本（SnapMirror复制）。

应为SnapMirror主动同步启用此选项。

在二次复制期间， SnapLock到期时间会加载主SnapLock到期时间。

单击拓扑页面中的“*刷新*”按钮可刷新从ONTAP检索到的辅助和主SnapLock到期时间。



 a| 
创建本地快照后更新SnapVault
 a| 
选择此选项可执行磁盘到磁盘备份复制（SnapVault备份）。

当仅在ONTAP的辅助节点（称为SnapLock Vault）上配置SnapLock时，单击拓扑页面中的 *刷新* 按钮将刷新从ONTAP检索到的辅助节点上的锁定期。

有关SnapLock Vault 的更多信息，请参阅 https://docs.netapp.com/us-en/ontap/snaplock/commit-snapshot-copies-worm-concept.html["将 Snapshot 副本提交到保管库目标上的 WORM"]

看link:../protect-sco/task_view_oracle_databse_backups_and_clones_in_the_topology_page.html["在拓扑页面中查看 Oracle 数据库备份和克隆"] 。



 a| 
错误重试次数
 a| 
输入操作停止之前允许的最大复制尝试次数。

|===
+

NOTE: 您应该在ONTAP中为二级存储配置SnapMirror保留策略，以避免达到二级存储上快照的最大限制。

. 在脚本页面中，分别输入要在备份操作之前或之后运行的前置脚本或后置脚本的路径和参数。
+
您必须将脚本和后记存储在 _/var/opt/snapcenter/spl/scripts_ 或此路径内的任何文件夹中。默认情况下，填充 _/var/opt/snapcenter/spl/scripts_ 路径。如果您在此路径内创建了任何文件夹来存储脚本，则必须在路径中指定这些文件夹。

+
您还可以指定脚本超时值。默认值是 60 秒。

+
SnapCenter允许您在执行前脚本和后脚本时使用预定义的环境变量。link:../protect-sco/predefined-environment-variables-prescript-postscript-backup.html["了解更多"^]

. 在验证页面中，执行以下步骤：
+
.. 选择要执行验证操作的备份计划。
.. 在验证脚本命令部分，分别输入要在验证操作之前或之后运行的脚本或后脚本的路径和参数。
+
您必须将脚本和后记存储在 _/var/opt/snapcenter/spl/scripts_ 或此路径内的任何文件夹中。默认情况下，填充 _/var/opt/snapcenter/spl/scripts_ 路径。如果您在此路径内创建了任何文件夹来存储脚本，则必须在路径中指定这些文件夹。

+
您还可以指定脚本超时值。默认值是 60 秒。



. 查看摘要，然后单击“*完成*”。

