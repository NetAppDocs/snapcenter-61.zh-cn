---
permalink: protect-hana/task_restore_and_recover_an_auto_discovered_database_backup.html 
sidebar: sidebar 
keywords: SnapCenter Plug-in for SAP HANA Database 
summary: 您可以使用SnapCenter从一个或多个备份中还原和恢复数据。 
---
= 还原和恢复自动发现的数据库备份
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
您可以使用SnapCenter从一个或多个备份中还原和恢复数据。

.开始之前
* 您必须已备份资源或资源组。
* 您必须取消当前正在进行的要还原的资源或资源组的任何备份操作。
* 对于还原前、还原后、安装和卸载命令，您应该检查这些命令是否存在于插件主机上可用的命令列表中，路径如下：
+
** Windows 主机上的默认位置：_C:\Program Files\ NetApp\ SnapCenter\Snapcenter Plug-in Creator\etc\allowed_commands.config_
** Linux 主机上的默认位置：_/opt/ NetApp/snapcenter/scc/etc/allowed_commands.config_





NOTE: 如果命令列表中不存在该命令，则操作将失败。

.关于此任务
* 无法从SnapCenter还原基于文件的备份副本。
* 升级到SnapCenter 4.3 后，可以还原在SnapCenter 4.2 中创建的备份，但无法恢复。您必须使用SnapCenter外部的 HANA 工作室或 HANA 恢复脚本来恢复在SnapCenter 4.2 中创建的备份。
* 对于ONTAP 9.12.1 及更早版本、作为恢复的一部分从SnapLock Vault 快照创建的克隆将继承SnapLock Vault 到期时间。存储管理员应在SnapLock到期后手动清理克隆。
* 对于SnapMirror活动同步恢复操作，您必须从主位置选择备份。


.步骤
. 在左侧导航窗格中，单击“*资源*”，然后从列表中选择适当的插件。
. 在资源页面中，根据资源类型从*查看*下拉列表中过滤资源。
+
资源与类型、主机、相关资源组和策略以及状态一起显示。

+

NOTE: 尽管备份可能针对资源组，但在恢复时，您必须选择要恢复的单个资源。

+
如果资源未受保护，则“总体状态”列中显示“未受保护”。这可能意味着该资源未受到保护，或者该资源已被其他用户备份。

. 选择资源，或者选择一个资源组，然后选择该组中的资源。
+
进入资源拓扑页面。

. 从“管理副本”视图中，从主存储系统或辅助存储系统（镜像或保管）中选择“*备份*”。
. 在主备份表中，选择要从中还原的备份，然后单击 *image:../media/restore_icon.gif["恢复图标"] *.
+
image::../media/restoring_resource.gif[恢复资源]

. 在“恢复范围”页面中，选择“*完整资源*”以恢复 SAP HANA 数据库的已配置数据卷。
+

NOTE: 您可以选择*完整资源*（带或不带*卷恢复*）或*租户数据库*。

+
当用户选择“租户数据库”或“完全还原”选项时， SnapCenter Server 不支持对多个租户执行恢复操作。您必须使用 HANA 工作室或 HANA python 脚本来执行恢复操作。

+
.. 如果您想恢复整个卷，请选择*卷恢复*。
+
此选项适用于在 NFS 环境中使用SnapCenter 4.3 进行的备份。

+
如果资源包含卷或 qtree，则在这些卷或 qtree 上选择还原的快照之后拍摄的快照将被删除，并且无法恢复。此外，如果任何其他资源托管在相同的卷或 qtree 上，则该资源也会被删除。当选择带有 *Volume Revert* 选项的 *Complete Resource* 进行恢复时，这适用。

.. 选择*租户数据库*。
+
此选项仅适用于 MDC 资源。

+
确保在执行恢复操作之前停止租户数据库。

+
如果选择“租户数据库”选项，则必须使用 HANA 工作室或使用SnapCenter外部的 HANA 恢复脚本来执行恢复操作。



. 在“恢复范围”页面中，选择以下选项之一：
+
|===
| 条件 | 操作 


 a| 
希望恢复到尽可能接近当前时间
 a| 
选择*恢复到最近的状态*。对于单个容器资源，指定一个或多个日志和目录备份位置。

对于多租户数据库容器 (MDC) 资源，指定一个或多个日志备份位置和备份目录位置。

对于 MDC 资源，路径应包含系统数据库和租户数据库日志。



 a| 
想要恢复到指定的时间点
 a| 
选择*恢复到时间点*。

.. 选择时区。
+
浏览器时区默认填充。

+
所选时区以及输入时间将转换为绝对格林威治标准时间。

.. 输入日期和时间。例如，HANA Linux 主机位于加利福尼亚州桑尼维尔，而北卡罗来纳州罗利的用户正在将日志恢复到SnapCenter。
+
这两个地点之间的时差为 3 小时，并且由于用户从北卡罗来纳州罗利市登录，因此 GUI 中选择的默认浏览器时区为 GMT-04:00。

+
如果用户想要恢复到凌晨 5 点，则用户必须将浏览器时区设置为 HANA Linux 主机时区，即 GMT-07:00，并将日期和时间指定为凌晨 5:00

+
对于单个容器资源，指定一个或多个日志和目录备份位置。

+
对于 MDC 资源，指定一个或多个日志备份位置和备份目录位置。

+
对于 MDC 资源，路径应包含系统数据库和租户数据库日志。





 a| 
想要恢复到特定的数据备份
 a| 
选择*恢复到指定的数据备份*。



 a| 
不想恢复
 a| 
选择*不恢复*。您必须从 HANA 工作室手动执行恢复操作。

|===
+
您只能恢复升级到SnapCenter 4.3 后创建的备份，前提是主机和插件都升级到SnapCenter 4.3，并且选择用于还原的备份是在资源转换或发现为自动发现的资源后创建的。

. 在“Pre ops”页面中，输入执行恢复作业之前要运行的预恢复和卸载命令。
+
卸载命令不适用于自动发现的资源。

. 在 Post ops 页面中，输入执行还原作业后要运行的 mount 和 post restore 命令。
+
自动发现的资源无法使用挂载命令。

. 在通知页面中，从*电子邮件首选项*下拉列表中，选择您想要发送电子邮件的场景。
+
您还必须指定发件人和收件人的电子邮件地址以及电子邮件的主题。还必须在*设置* > *全局设置*页面上配置 SMTP。

. 查看摘要，然后单击“*完成*”。
. 通过单击“*监视*”>“*作业*”来监视操作进度。

